{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            deviceId: '',\n            processNames: [\n                '来料检',\n                '过程检',\n                '插接头焊接',\n                '固定头焊接',\n                '导管安装',\n                '接地线焊接',\n                '转轮安装',\n                '上壳组件安装',\n                '手柄手轮安装',\n                '内包',\n                '完工检',\n                '出厂检'\n            ],\n            currentProcessIndex: 0,\n            processList: Array(12).fill().map(() => { return (new UTSJSONObject({\n                inspector: '',\n                inspectTime: '',\n                image: '' // 检测图片\n            })); })\n        };\n    },\n    computed: {\n        currentProcess() {\n            return this.processList[this.currentProcessIndex];\n        }\n    },\n    onLoad(options) {\n        if (options.deviceId) {\n            this.deviceId = options.deviceId;\n        }\n    },\n    methods: {\n        // 处理工序选择\n        handleProcessChange(e = null) {\n            this.currentProcessIndex = Number(e.detail.value);\n        },\n        // 处理日期选择\n        handleDateChange(e = null) {\n            this.currentProcess.inspectTime = e.detail.value;\n        },\n        // 处理图片上传\n        handleUploadImage() {\n            uni.chooseImage(new UTSJSONObject({\n                count: 1,\n                success: (res) => {\n                    const tempFilePath = res.tempFilePaths[0];\n                    // 捕获当前工序索引\n                    const processIndex = this.currentProcessIndex;\n                    // 提取文件扩展名，若没有则默认使用 .jpg\n                    const dotIndex = tempFilePath.lastIndexOf('.');\n                    const ext = dotIndex !== -1 ? tempFilePath.substring(dotIndex) : '.jpg';\n                    uni.showLoading({ title: '上传中...' });\n                    // 使用设备编号和对应工序命名，例如：upload/设备编号_工序名称_时间戳.ext\n                    const cloudPath = `upload/${this.deviceId}_${this.processNames[processIndex]}_${Date.now()}${ext}`;\n                    uniCloud.uploadFile({\n                        filePath: tempFilePath,\n                        cloudPath: cloudPath\n                    }).then(uploadRes => {\n                        if (uploadRes && uploadRes.fileID) {\n                            uniCloud.getTempFileURL({\n                                fileList: [uploadRes.fileID]\n                            }).then(tempUrlRes => {\n                                const tempUrl = tempUrlRes.fileList[0].tempFileURL;\n                                // 更新当前工序图片\n                                this.processList[processIndex].image = tempUrl;\n                                uni.hideLoading();\n                                uni.showToast({ title: '上传成功', icon: 'success' });\n                            }).catch((err = null) => {\n                                uni.hideLoading();\n                                uni.showToast({ title: '获取预览图失败', icon: 'none' });\n                                uni.__f__('error', 'at pages/device-form/index.vue:167', err);\n                            });\n                        }\n                        else {\n                            uni.hideLoading();\n                            uni.showToast({ title: '图片上传失败', icon: 'none' });\n                        }\n                    }).catch((err = null) => {\n                        uni.hideLoading();\n                        uni.showToast({ title: '图片上传失败', icon: 'none' });\n                        uni.__f__('error', 'at pages/device-form/index.vue:176', err);\n                    });\n                },\n                fail: () => {\n                    uni.showToast({ title: '图片选择失败', icon: 'none' });\n                }\n            }));\n        },\n        // 提交表单\n        handleSubmit() {\n            // 表单验证\n            if (!this.validateForm()) {\n                return null;\n            }\n            // 提交数据到服务器\n            uni.__f__('log', 'at pages/device-form/index.vue:193', '表单数据：', this.currentProcess);\n            uni.showToast({\n                title: '提交成功',\n                icon: 'success'\n            });\n        },\n        // 表单验证\n        validateForm() {\n            const process = this.currentProcess;\n            if (!process.inspector || !process.inspectTime) {\n                uni.showToast({\n                    title: '请完善当前工序信息',\n                    icon: 'none'\n                });\n                return false;\n            }\n            return true;\n        }\n    }\n});\n//# sourceMappingURL=E:/table/APE/Scancode_tiyan/Scancode/pages/device-form/index.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.chooseImage","uni.showLoading","uniCloud.uploadFile","uniCloud.getTempFileURL","uni.hideLoading","uni.showToast","uni.__f__"],"map":"{\"version\":3,\"file\":\"index.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"index.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
