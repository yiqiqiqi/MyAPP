{"version":3,"file":"index.js","sources":["pages/device-form/index.vue","../../../APE/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGV2aWNlLWZvcm0vaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"device-form\">\r\n    <form @submit=\"handleSubmit\">\r\n      <!-- 设备基本信息 -->\r\n      <view class=\"form-header\">\r\n        <text class=\"form-title\">设备检测表单</text>\r\n        <view class=\"device-info\">\r\n          <text>设备编号：{{ deviceId }}</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 工序选择 -->\r\n      <view class=\"process-section\">\r\n        <text class=\"label\">选择工序</text>\r\n        <picker\r\n          mode=\"selector\"\r\n          :range=\"processNames\"\r\n          :value=\"currentProcessIndex\"\r\n          @change=\"handleProcessChange\"\r\n          class=\"process-picker\"\r\n        >\r\n          <view class=\"picker-text\">\r\n            {{ processNames[currentProcessIndex] || '请选择工序' }}\r\n          </view>\r\n        </picker>\r\n      </view>\r\n\r\n      <!-- 当前工序表单 -->\r\n      <view class=\"form-section\">\r\n        <!-- 检测人员 -->\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">检测人员</text>\r\n          <input \r\n            type=\"text\"\r\n            v-model=\"currentProcess.inspector\"\r\n            placeholder=\"请输入检测人员姓名\"\r\n          />\r\n        </view>\r\n\r\n        <!-- 检测时间 -->\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">检测时间</text>\r\n          <picker\r\n            mode=\"date\"\r\n            :value=\"currentProcess.inspectTime\"\r\n            @change=\"handleDateChange\"\r\n          >\r\n            <view class=\"picker-text\">\r\n              {{ currentProcess.inspectTime || '请选择检测时间' }}\r\n            </view>\r\n          </picker>\r\n        </view>\r\n\r\n        <!-- 检测图片 -->\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">检测图片</text>\r\n          <view class=\"image-upload\">\r\n            <image \r\n              v-if=\"currentProcess.image\" \r\n              :src=\"currentProcess.image\" \r\n              mode=\"aspectFit\"\r\n              class=\"preview-image\"\r\n            />\r\n            <button \r\n              class=\"upload-btn\"\r\n              @tap=\"handleUploadImage\"\r\n            >\r\n              {{ currentProcess.image ? '重新上传' : '上传图片' }}\r\n            </button>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 提交按钮 -->\r\n      <button \r\n        form-type=\"submit\"\r\n        type=\"primary\"\r\n        class=\"submit-btn\"\r\n      >\r\n        提交表单\r\n      </button>\r\n    </form>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\nexport default {\r\n  data() {\r\n    return {\r\n      deviceId: '', // 设备ID\r\n      processNames: [\r\n         '来料检',\r\n         '过程检',\r\n         '插接头焊接',\r\n         '固定头焊接',\r\n         '导管安装',\r\n         '接地线焊接',\r\n         '转轮安装',\r\n         '上壳组件安装',\r\n         '手柄手轮安装',\r\n         '内包',\r\n         '完工检',\r\n         '出厂检'\r\n      ],\r\n      currentProcessIndex: 0,  // 当前选中的工序索引\r\n      processList: Array(12).fill().map(() => ({\r\n        inspector: '', // 检测人员\r\n        inspectTime: '', // 检测时间\r\n        image: '' // 检测图片\r\n      }))\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    currentProcess() {\r\n      return this.processList[this.currentProcessIndex];\r\n    }\r\n  },\r\n\r\n  onLoad(options) {\r\n    if (options.deviceId) {\r\n      this.deviceId = options.deviceId\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    // 处理工序选择\r\n    handleProcessChange(e) {\r\n      this.currentProcessIndex = Number(e.detail.value);\r\n    },\r\n\r\n    // 处理日期选择\r\n    handleDateChange(e) {\r\n      this.currentProcess.inspectTime = e.detail.value;\r\n    },\r\n\r\n    // 处理图片上传\r\n    handleUploadImage() {\r\n      uni.chooseImage({\r\n        count: 1,\r\n        success: (res) => {\r\n          const tempFilePath = res.tempFilePaths[0];\r\n          // 捕获当前工序索引\r\n          const processIndex = this.currentProcessIndex;\r\n          // 提取文件扩展名，若没有则默认使用 .jpg\r\n          const dotIndex = tempFilePath.lastIndexOf('.');\r\n          const ext = dotIndex !== -1 ? tempFilePath.substring(dotIndex) : '.jpg';\r\n          uni.showLoading({ title: '上传中...' });\r\n          // 使用设备编号和对应工序命名，例如：upload/设备编号_工序名称_时间戳.ext\r\n          const cloudPath = `upload/${this.deviceId}_${this.processNames[processIndex]}_${Date.now()}${ext}`;\r\n          uniCloud.uploadFile({\r\n            filePath: tempFilePath,\r\n            cloudPath: cloudPath\r\n          }).then(uploadRes => {\r\n            if (uploadRes && uploadRes.fileID) {\r\n              uniCloud.getTempFileURL({\r\n                fileList: [uploadRes.fileID]\r\n              }).then(tempUrlRes => {\r\n                const tempUrl = tempUrlRes.fileList[0].tempFileURL;\r\n                // 更新当前工序图片\r\n                this.processList[processIndex].image = tempUrl;\r\n                uni.hideLoading();\r\n                uni.showToast({ title: '上传成功', icon: 'success' });\r\n              }).catch(err => {\r\n                uni.hideLoading();\r\n                uni.showToast({ title: '获取预览图失败', icon: 'none' });\r\n                uni.__f__('error','at pages/device-form/index.vue:167',err);\r\n              });\r\n            } else {\r\n              uni.hideLoading();\r\n              uni.showToast({ title: '图片上传失败', icon: 'none' });\r\n            }\r\n          }).catch(err => {\r\n            uni.hideLoading();\r\n            uni.showToast({ title: '图片上传失败', icon: 'none' });\r\n            uni.__f__('error','at pages/device-form/index.vue:176',err);\r\n          });\r\n        },\r\n        fail: () => {\r\n          uni.showToast({ title: '图片选择失败', icon: 'none' });\r\n        }\r\n      });\r\n    },\r\n\r\n    // 提交表单\r\n    handleSubmit() {\r\n      // 表单验证\r\n      if (!this.validateForm()) {\r\n        return\r\n      }\r\n\r\n      // 提交数据到服务器\r\n      uni.__f__('log','at pages/device-form/index.vue:193','表单数据：', this.currentProcess)\r\n      uni.showToast({\r\n        title: '提交成功',\r\n        icon: 'success'\r\n      })\r\n    },\r\n\r\n    // 表单验证\r\n    validateForm() {\r\n      const process = this.currentProcess;\r\n      if (!process.inspector || !process.inspectTime) {\r\n        uni.showToast({\r\n          title: '请完善当前工序信息',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.device-form {\r\n  padding: 20rpx;\r\n\r\n  .form-header {\r\n    margin-bottom: 30rpx;\r\n    \r\n    .form-title {\r\n      font-size: 36rpx;\r\n      font-weight: bold;\r\n    }\r\n\r\n    .device-info {\r\n      margin-top: 10rpx;\r\n      color: #666;\r\n    }\r\n  }\r\n\r\n  .process-section {\r\n    margin-bottom: 40rpx;\r\n    padding: 20rpx;\r\n    background-color: #f8f8f8;\r\n    border-radius: 8rpx;\r\n\r\n    .label {\r\n      display: block;\r\n      margin-bottom: 10rpx;\r\n      color: #333;\r\n    }\r\n  }\r\n\r\n  .process-picker {\r\n    width: 100%;\r\n    height: 70rpx;\r\n    line-height: 70rpx;\r\n    padding: 0 20rpx;\r\n    background-color: #fff;\r\n    border: 1rpx solid #ddd;\r\n    border-radius: 4rpx;\r\n  }\r\n\r\n  .form-section {\r\n    margin-bottom: 40rpx;\r\n    padding: 20rpx;\r\n    background-color: #f8f8f8;\r\n    border-radius: 8rpx;\r\n  }\r\n\r\n  .form-item {\r\n    margin-bottom: 20rpx;\r\n\r\n    .label {\r\n      display: block;\r\n      margin-bottom: 10rpx;\r\n      color: #333;\r\n    }\r\n\r\n    input {\r\n      width: 100%;\r\n      height: 70rpx;\r\n      padding: 0 20rpx;\r\n      background-color: #fff;\r\n      border: 1rpx solid #ddd;\r\n      border-radius: 4rpx;\r\n    }\r\n\r\n    .picker-text {\r\n      width: 100%;\r\n      height: 70rpx;\r\n      line-height: 70rpx;\r\n      padding: 0 20rpx;\r\n      background-color: #fff;\r\n      border: 1rpx solid #ddd;\r\n      border-radius: 4rpx;\r\n    }\r\n  }\r\n\r\n  .image-upload {\r\n    .preview-image {\r\n      width: 200rpx;\r\n      height: 200rpx;\r\n      margin-bottom: 20rpx;\r\n    }\r\n\r\n    .upload-btn {\r\n      width: 200rpx;\r\n      font-size: 28rpx;\r\n    }\r\n  }\r\n\r\n  .submit-btn {\r\n    margin-top: 40rpx;\r\n    width: 100%;\r\n  }\r\n}\r\n</style> ","import MiniProgramPage from 'E:/table/SOTFWARE/mycompany/Scancode/pages/device-form/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","uniCloud"],"mappings":"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"}