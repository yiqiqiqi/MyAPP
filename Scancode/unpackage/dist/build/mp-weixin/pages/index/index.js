(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{3579:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var s=function(){var e=this.$createElement,t=(this._self._c,this.isLoggedIn&&null!==this.currentProcessIndex?this.inspectResultOptions.indexOf(this.currentProcess.inspectResult):null);this.$mp.data=Object.assign({},{$root:{g0:t}})},o=[]},"9c20":function(e,t,n){},c65e:function(e,t,n){"use strict";n.r(t);var s=n("d94e"),o=n.n(s);for(var c in s)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(c);t["default"]=o.a},d94e:function(e,t,n){"use strict";(function(e,s){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n("7eb4")),r=o(n("ee10")),i=o(n("7ca3"));function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={data:function(){return{isLoggedIn:!1,loginAccount:"",loginPassword:"",allowedAccount:"admin",allowedPassword:"123456",deviceId:"",currentProcessIndex:null,processNames:["（康鼎）穿光纤及模组","（康鼎）固定环处理","（康鼎）过程检","（康鼎）成品检","来料检","清洗","固定头焊接","插接头焊接","接地线焊接","电路板封胶","上壳锁轮安装","散热片安装","导管安装","转轮安装","上壳组件安装","手柄手轮安装","过程检","完工检","内包检","外包检","最终检","出厂检"],processList:Array(22).fill().map((function(){return{inspector:"",inspectTime:"",image:"",inspectResult:""}})),inspectResultOptions:["合格","不合格","遮光3%可遮","软头漏光","前端光纤断","通体漏光","软头漏光长度超5mm"],exportRequestActive:!1}},computed:{currentProcess:function(){return null!==this.currentProcessIndex?this.processList[this.currentProcessIndex]:null}},onLoad:function(){var t=e.getStorageSync("scanHistory");t&&(this.scanHistory=JSON.parse(t))},methods:{checkLogin:function(){this.loginAccount.trim()===this.allowedAccount&&this.loginPassword===this.allowedPassword?this.isLoggedIn=!0:e.showToast({title:"账号或密码错误",icon:"none"})},scanCode:function(){var t=this;e.scanCode({success:function(e){t.deviceId=e.result},fail:function(t){e.showToast({title:"扫码失败",icon:"none"})}})},handleProcessChange:function(e){this.currentProcessIndex=Number(e.detail.value)},handleDateChange:function(e){this.processList[this.currentProcessIndex].inspectTime=e.detail.value},handleUploadImage:function(){var t=this;e.chooseImage({count:1,success:function(n){var o=n.tempFilePaths[0],c=t.currentProcessIndex,r=o.lastIndexOf("."),i=-1!==r?o.substring(r):".jpg";e.showLoading({title:"上传中..."});var a=encodeURIComponent(t.deviceId),l="P"+(c+1),d=encodeURIComponent(t.currentProcess.inspector),p=encodeURIComponent(t.currentProcess.inspectTime),f={"合格":"R1","不合格":"R2","遮光3%可遮":"R3","软头漏光":"R4","前端光纤断":"R5","通体漏光":"R6","软头漏光长度超5mm":"R7"}[t.currentProcess.inspectResult]||"UNK",h="upload/".concat(a,"_").concat(l,"_").concat(d,"_").concat(p,"_").concat(f,"_").concat(Date.now()).concat(i);s.uploadFile({filePath:o,cloudPath:h,fileType:"image"}).then((function(n){n&&n.fileID?s.getTempFileURL({fileList:[n.fileID]}).then((function(n){var s=n.fileList[0].tempFileURL;s=s+"?t="+Date.now(),t.$set(t.processList,c,u(u({},t.processList[c]),{},{image:s})),e.hideLoading(),e.showToast({title:"上传成功",icon:"success"})})).catch((function(t){e.hideLoading(),e.showToast({title:"获取预览图失败",icon:"none"}),console.error(t)})):(e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"}))})).catch((function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"}),console.error(t)}))},fail:function(){e.showToast({title:"图片选择失败",icon:"none"})}})},handleSubmit:function(){var t=this;return(0,r.default)(c.default.mark((function n(){var o;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.deviceId){n.next=3;break}return e.showToast({title:"请先输入或扫码获取设备编号",icon:"none"}),n.abrupt("return");case 3:if(t.validateForm()){n.next=5;break}return n.abrupt("return");case 5:return n.prev=5,e.showLoading({title:"提交中..."}),n.next=9,s.callFunction({name:"submit_process",data:{deviceId:t.deviceId,processName:t.processNames[t.currentProcessIndex],processData:{inspector:t.currentProcess.inspector,inspectTime:t.currentProcess.inspectTime,inspectResult:t.currentProcess.inspectResult,image:t.currentProcess.image}}});case 9:if(o=n.sent,0!==o.result.code){n.next=15;break}e.showToast({title:"提交成功",icon:"success"}),t.processList[t.currentProcessIndex]={inspector:"",inspectTime:"",image:"",inspectResult:""},n.next=16;break;case 15:throw new Error(o.result.msg);case 16:n.next=22;break;case 18:n.prev=18,n.t0=n["catch"](5),e.showToast({title:n.t0.message||"提交失败",icon:"none"}),console.error("提交失败：",n.t0);case 22:return n.prev=22,e.hideLoading(),n.finish(22);case 25:case"end":return n.stop()}}),n,null,[[5,18,22,25]])})))()},handleExport:function(){var t=this;return(0,r.default)(c.default.mark((function n(){var o;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.exportRequestActive=!0,n.prev=1,e.showLoading({title:"导出中..."}),n.next=5,s.callFunction({name:"export_all_excel"});case 5:if(o=n.sent,e.hideLoading(),t.exportRequestActive){n.next=10;break}return e.showToast({title:"导出已终止",icon:"none"}),n.abrupt("return");case 10:o.result&&0===o.result.code?(e.showToast({title:"导出成功",icon:"success"}),console.log("Excel 文件链接：",o.result.data.excelFile)):e.showToast({title:"导出失败",icon:"none"}),n.next=18;break;case 13:n.prev=13,n.t0=n["catch"](1),e.hideLoading(),t.exportRequestActive&&e.showToast({title:"导出失败",icon:"none"}),console.error(n.t0);case 18:t.exportRequestActive=!1;case 19:case"end":return n.stop()}}),n,null,[[1,13]])})))()},handleCancelExport:function(){this.exportRequestActive&&(this.exportRequestActive=!1,e.hideLoading(),e.showToast({title:"已终止导出",icon:"none"}),console.log("导出操作已终止"))},validateForm:function(){var t=this.currentProcess;return!(!t.inspector||!t.inspectTime)||(e.showToast({title:"请完善当前工序信息",icon:"none"}),!1)},handleInspectResultChange:function(e){var t=Number(e.detail.value);this.processList[this.currentProcessIndex].inspectResult=this.inspectResultOptions[t]}}};t.default=l}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},dcba:function(e,t,n){"use strict";(function(e,t){var s=n("47a9");n("1872"),n("861b");s(n("3240"));var o=s(n("e36d"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},e36d:function(e,t,n){"use strict";n.r(t);var s=n("3579"),o=n("c65e");for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);n("ee65");var r=n("828b"),i=Object(r["a"])(o["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);t["default"]=i.exports},ee65:function(e,t,n){"use strict";var s=n("9c20"),o=n.n(s);o.a}},[["dcba","common/runtime","common/vendor"]]]);